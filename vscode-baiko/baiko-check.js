"use strict";var E=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var L=(p,e)=>{for(var t in e)E(p,t,{get:e[t],enumerable:!0})},A=(p,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of B(e))!S.call(p,i)&&i!==t&&E(p,i,{get:()=>e[i],enumerable:!(a=b(e,i))||a.enumerable});return p};var P=p=>A(E({},"__esModule",{value:!0}),p);var D={};L(D,{checkBaiko:()=>V});module.exports=P(D);var I={asa:"Asa",raha:"Raha",ankoatra:"Ankoatra",mamoaka:"Mamoaka",dia:"Dia",farany:"Farany",asehoy:"Asehoy",avereno:"Avereno",marina:"True",diso:"False",tsisy:"Tsisy",Mety:"Mety",ampidiro:"Ampidiro",avoaka:"Avoaka",andrasana:"Andrasana",miandry:"Miandry",ary:"And",na:"Or",tsy:"Not",Isa:"Isa",Soratra:"Soratra",Marina:"Marina",Lisitra:"Lisitra"},k=class{constructor(e){this.pos=0;this.line=1;this.column=1;this.source=e}tokenize(){let e=[];for(;this.pos<this.source.length&&(this.skipWhitespaceAndComments(),!(this.pos>=this.source.length));)e.push(this.nextToken());return e.push({type:"EOF",value:"",line:this.line,column:this.column}),e}nextToken(){let e=this.source[this.pos],t=this.line,a=this.column;if(this.isDigit(e))return this.readNumber(t,a);if(e==='"')return this.readString(t,a);if(this.isAlpha(e))return this.readWord(t,a);let i=this.source.slice(this.pos,this.pos+2),n={"==":"EqualEqual","!=":"BangEqual","<=":"LessEqual",">=":"GreaterEqual"};if(n[i])return this.pos+=2,this.column+=2,{type:n[i],value:i,line:t,column:a};let s={"+":"Plus","-":"Minus","*":"Star","/":"Slash","=":"Equal","<":"Less",">":"Greater","(":"LeftParen",")":"RightParen",":":"Colon",",":"Comma",";":"Semicolon",".":"Dot","[":"LeftBracket","]":"RightBracket"};if(s[e])return this.advance(),{type:s[e],value:e,line:t,column:a};throw new Error(`Litera tsy fantatra '${e}' (andalana ${t}, toerana ${a})`)}readNumber(e,t){let a="";for(;this.pos<this.source.length&&this.isDigit(this.source[this.pos]);)a+=this.advance();if(this.source[this.pos]===".")for(a+=this.advance();this.pos<this.source.length&&this.isDigit(this.source[this.pos]);)a+=this.advance();return{type:"Number",value:a,line:e,column:t}}readString(e,t){this.advance();let a="";for(;this.pos<this.source.length&&this.source[this.pos]!=='"';)if(this.source[this.pos]==="\\"){this.advance();let i=this.advance();a+=i==="n"?`
`:i==="t"?"	":i}else a+=this.advance();if(this.pos>=this.source.length)throw new Error(`Soratra tsy voafaritra: tsy misy '"' mamarana ny soratra natomboka (andalana ${e}, toerana ${t})`);return this.advance(),{type:"String",value:a,line:e,column:t}}readWord(e,t){let a="";for(;this.pos<this.source.length&&this.isAlphaNumeric(this.source[this.pos]);)a+=this.advance();return{type:I[a]??"Identifier",value:a,line:e,column:t}}skipWhitespaceAndComments(){for(;this.pos<this.source.length;){let e=this.source[this.pos];if(/\s/.test(e)){e===`
`?(this.line++,this.column=1):this.column++,this.pos++;continue}if(e==="#"){for(;this.pos<this.source.length&&this.source[this.pos]!==`
`;)this.pos++;continue}break}}advance(){let e=this.source[this.pos++];return this.column++,e}isDigit(e){return e>="0"&&e<="9"}isAlpha(e){return/[a-zA-Z_]/.test(e)}isAlphaNumeric(e){return/[a-zA-Z0-9_]/.test(e)}};var T=new Set(["Isa","Soratra","Marina"]),w=new Set([...T,"Mety","Lisitra"]),$={Semicolon:'";" (famaranana ny tsipika)',Dia:'"dia" (fanombohana ny bloka)',Farany:'"farany" (famaranana ny bloka)',Ankoatra:'"ankoatra" (sampana hafa)',Equal:'"=" (fandrafesana)',EqualEqual:'"==" (fitoviana)',Colon:'":" (mari-karazana)',Comma:'"," (misaraka ny tohan-teny)',LeftParen:'"(" (fanombohana ny tohan-teny)',RightParen:'")" (famaranana ny tohan-teny)',Identifier:"anarana (identifier)",Isa:'"Isa" (karazana isa)',Soratra:'"Soratra" (karazana soratra)',Marina:'"Marina" (karazana boolean)',Mety:'"Mety" (karazana azo tsisy)',Raha:'"raha"',Avoaka:`"avoaka" (fanambaran'ny avoaka)`,Andrasana:'"andrasana" (asa tsy mitoky)'};function x(p,e){return`(andalana ${p}, toerana ${e})`}var v=class{constructor(e){this.pos=0;this.tokens=e}parse(){let e=[];for(;!this.isEOF();)e.push(this.parseStatement());return{type:"Program",body:e}}parseStatement(){if(this.check("Avoaka"))return this.parseExportedStatement();if(this.check("Avereno")&&this.tokens[this.pos+1]?.type==="Raha")return this.parseWhileStatement();if(this.check("Identifier")&&this.tokens[this.pos+1]?.type==="Colon"&&w.has(this.tokens[this.pos+2]?.type))return this.parseVariableDeclaration();if(this.check("Identifier")&&this.tokens[this.pos+1]?.type==="LeftBracket"){let e=this.pos;try{let t=this.tryParseIndexAssignment();if(t)return t}catch{this.pos=e}}switch(this.peek().type){case"Asa":return this.parseFunctionDeclaration();case"Andrasana":return this.parseAsyncFunctionDeclaration();case"Raha":return this.parseIfStatement();case"Mamoaka":return this.parseReturnStatement();case"Asehoy":return this.parsePrintStatement();case"Ampidiro":return this.parseImportStatement();default:return this.parseExpressionStatement()}}parseAsyncFunctionDeclaration(){this.expect("Andrasana");let e=this.parseFunctionDeclaration();return e.async=!0,e}parseExportedStatement(){if(this.expect("Avoaka"),this.check("Andrasana")){let t=this.parseAsyncFunctionDeclaration();return t.exported=!0,t}if(this.check("Asa")){let t=this.parseFunctionDeclaration();return t.exported=!0,t}if(this.check("Identifier")&&this.tokens[this.pos+1]?.type==="Colon"&&w.has(this.tokens[this.pos+2]?.type)){let t=this.parseVariableDeclaration();return t.exported=!0,t}let e=this.peek();throw new Error(`"avoaka" tokony hitohana "asa" na fanambarana karazana \u2014 "${e.value}" no noraisina ${x(e.line,e.column)}`)}parseFunctionDeclaration(){this.expect("Asa");let e=this.expect("Identifier").value;this.expect("LeftParen");let t=this.parseParams();this.expect("RightParen");let a=null;this.match("Colon")&&(a=this.parseBaseType()),this.expect("Dia");let i=this.parseBlock();return this.expect("Farany"),{type:"FunctionDeclaration",name:e,params:t,returnType:a,body:i,exported:!1,async:!1}}parseVariableDeclaration(){let e=this.peek(),t=this.expect("Identifier").value;this.expect("Colon");let a=this.parseVarType(),i=typeof a=="object",n=null;if(this.match("Equal"))n=this.parseExpression();else if(!i){let s=this.peek();throw new Error(`"${t}" karazana tsy azo tsisy: tokony hanana soatoavina fiorenana ${x(s.line,s.column)}`)}return this.expect("Semicolon"),{type:"VariableDeclaration",varType:a,name:t,value:n,exported:!1,line:e.line,col:e.column}}parseVarType(){if(this.check("Mety")){this.advance(),this.expect("LeftParen");let e=this.parseType();return this.expect("RightParen"),{kind:"Mety",inner:e}}return this.parseType()}parseParams(){let e=[];if(this.check("RightParen"))return e;do{let t=this.expect("Identifier").value;this.expect("Colon");let a=this.parseBaseType();e.push({type:"Parameter",name:t,paramType:a})}while(this.match("Comma"));return e}parseType(){if(this.check("Lisitra")){this.advance(),this.expect("LeftParen");let e=this.parseType();return this.expect("RightParen"),{kind:"Lisitra",inner:e}}return this.parseBaseType()}parseBaseType(){let e=this.peek();if(!T.has(e.type))throw new Error(`Tokony ho karazana (Isa, Soratra, Marina) fa "${e.value}" no noraisina ${x(e.line,e.column)}`);return this.advance(),e.value}parseIfStatement(){this.expect("Raha");let e=this.parseExpression();this.expect("Dia");let t=this.parseBlock(),a=null;return this.match("Ankoatra")&&(this.expect("Dia"),a=this.parseBlock()),this.expect("Farany"),{type:"IfStatement",condition:e,consequent:t,alternate:a}}parseWhileStatement(){this.expect("Avereno"),this.expect("Raha");let e=this.parseExpression();this.expect("Dia");let t=this.parseBlock();return this.expect("Farany"),{type:"WhileStatement",condition:e,body:t}}parseReturnStatement(){this.expect("Mamoaka");let e=null;return this.check("Semicolon")||(e=this.parseExpression()),this.expect("Semicolon"),{type:"ReturnStatement",value:e}}parsePrintStatement(){this.expect("Asehoy");let e=this.parseExpression();return this.expect("Semicolon"),{type:"PrintStatement",value:e}}parseImportStatement(){this.expect("Ampidiro");let e=this.expect("String");return this.expect("Semicolon"),{type:"ImportStatement",path:e.value}}parseExpressionStatement(){let e=this.parseExpression();return this.expect("Semicolon"),{type:"ExpressionStatement",expression:e}}parseBlock(){let e=[],t=new Set(["Farany","Ankoatra","EOF"]);for(;!t.has(this.peek().type);)e.push(this.parseStatement());return e}parseExpression(){return this.parseAssignment()}parseAssignment(){if(this.check("Identifier")&&this.tokens[this.pos+1]?.type==="Equal"){let e=this.advance().value;this.advance();let t=this.parseExpression();return{type:"AssignmentExpression",name:e,value:t}}return this.parseLogicalOr()}parseLogicalOr(){let e=this.parseLogicalAnd();for(;this.check("Or");){let t=this.advance().value,a=this.parseLogicalAnd();e={type:"BinaryExpression",operator:t,left:e,right:a}}return e}parseLogicalAnd(){let e=this.parseComparison();for(;this.check("And");){let t=this.advance().value,a=this.parseComparison();e={type:"BinaryExpression",operator:t,left:e,right:a}}return e}parseComparison(){let e=this.parseAdditive(),t=new Set(["EqualEqual","BangEqual","Less","LessEqual","Greater","GreaterEqual"]);for(;t.has(this.peek().type);){let a=this.advance().value,i=this.parseAdditive();e={type:"BinaryExpression",operator:a,left:e,right:i}}return e}parseAdditive(){let e=this.parseMultiplicative();for(;this.check("Plus")||this.check("Minus");){let t=this.advance().value,a=this.parseMultiplicative();e={type:"BinaryExpression",operator:t,left:e,right:a}}return e}parseMultiplicative(){let e=this.parseUnary();for(;this.check("Star")||this.check("Slash");){let t=this.advance().value,a=this.parseUnary();e={type:"BinaryExpression",operator:t,left:e,right:a}}return e}parseUnary(){if(this.check("Miandry"))return this.advance(),{type:"AwaitExpression",value:this.parseUnary()};if(this.check("Not"))return this.advance(),{type:"UnaryExpression",operator:"tsy",operand:this.parseUnary()};if(this.check("Minus")){let e=this.advance().value,t=this.parsePrimary();return{type:"BinaryExpression",operator:e,left:{type:"NumericLiteral",value:0},right:t}}return this.parsePrimary()}parsePrimary(){let e=this.peek();if(e.type==="Number")return this.advance(),{type:"NumericLiteral",value:parseFloat(e.value)};if(e.type==="String")return this.advance(),{type:"StringLiteral",value:e.value};if(e.type==="LeftBracket"){this.advance();let t=[];if(!this.check("RightBracket"))do t.push(this.parseExpression());while(this.match("Comma"));return this.expect("RightBracket"),this.parsePostfix({type:"ListLiteral",elements:t},e)}if(e.type==="Identifier"){if(this.advance(),this.match("LeftParen")){let t=this.parseArgs();return this.expect("RightParen"),{type:"CallExpression",callee:e.value,args:t}}return this.parsePostfix({type:"Identifier",name:e.value},e)}if(e.type==="True"||e.type==="False")return this.advance(),{type:"BooleanLiteral",value:e.type==="True"};if(e.type==="Tsisy")return this.advance(),{type:"TsisyLiteral"};if(e.type==="LeftParen"){this.advance();let t=this.parseExpression();return this.expect("RightParen"),t}throw new Error(`Teny tsy andraina: "${e.value}" ${x(e.line,e.column)}`)}tryParseIndexAssignment(){let e=this.pos,t=this.peek(),a=this.advance().value;this.advance();let i=this.parseExpression();if(!this.match("RightBracket"))return this.pos=e,null;if(!this.match("Equal"))return this.pos=e,null;let n=this.parseExpression();return this.expect("Semicolon"),{type:"IndexAssignmentStatement",object:a,index:i,value:n,line:t.line,col:t.column}}parsePostfix(e,t){let a=e;for(;this.check("Dot")||this.check("LeftBracket");)if(this.match("Dot")){let i=this.peek();if(i.type==="EOF")throw new Error(`Tokony ho anarana aorian'ny "." ${x(i.line,i.column)}`);let n=this.advance().value;if(this.match("LeftParen")){let s=this.parseArgs();this.expect("RightParen"),a={type:"MemberCallExpression",object:a,method:n,args:s,line:t.line,col:t.column}}else a={type:"MemberExpression",object:a,property:n}}else{this.advance();let i=this.parseExpression();this.expect("RightBracket"),a={type:"IndexExpression",object:a,index:i}}return a}parseArgs(){let e=[];if(this.check("RightParen"))return e;do e.push(this.parseExpression());while(this.match("Comma"));return e}match(...e){for(let t of e)if(this.check(t))return this.advance(),!0;return!1}expect(e){if(!this.check(e)){let t=this.peek(),a=$[e]??`"${e}"`,i=t.value?`"${t.value}"`:"fiafaran'ny rakitra";throw new Error(`Nandiny ${i} fa nilaina ${a} ${x(t.line,t.column)}`)}return this.advance()}check(e){return this.peek().type===e}advance(){return this.isEOF()||this.pos++,this.tokens[this.pos-1]}peek(){return this.tokens[this.pos]}isEOF(){return this.peek().type==="EOF"}};function R(p){return(p.includes("/")?p.split("/").pop():p).replace(/[^a-zA-Z0-9_]/g,"_")}var y=class{constructor(e){this.value=e}},h=class{constructor(e=null){this.parent=e;this.store=new Map}get(e){if(this.store.has(e))return this.store.get(e);if(this.parent)return this.parent.get(e);throw new r(`Tsy fantatra ny "${e}" \u2014 ilaina ny fanambarana azy aloha`)}define(e,t){this.store.set(e,t)}assign(e,t){if(this.store.has(e)){this.store.set(e,t);return}if(this.parent){this.parent.assign(e,t);return}throw new r(`Tsy azo ovaina ny "${e}" \u2014 tsy mbola nofaritana`)}},r=class extends Error{constructor(e){super(e),this.name="RuntimeError"}},g=class{constructor(e,t,a){this.global=new h;this.imported=new Set;this.printFn=e??(i=>console.log(i)),this.resolver=t??(()=>{throw new r("Tsy azo ampidirina ny rakitra ato amin'ity toerana ity")}),this.pkgResolver=a??(i=>require(i))}async run(e){for(let t of e.body)await this.execStmt(t,this.global)}async execStmt(e,t){switch(e.type){case"VariableDeclaration":return this.execVarDecl(e,t);case"FunctionDeclaration":return this.execFuncDecl(e,t);case"ImportStatement":return this.execImport(e,t);case"IfStatement":return this.execIf(e,t);case"WhileStatement":return this.execWhile(e,t);case"ReturnStatement":return this.execReturn(e,t);case"PrintStatement":return this.execPrint(e,t);case"ExpressionStatement":await this.execExpr(e.expression,t);return;case"IndexAssignmentStatement":return this.execIndexAssignment(e,t)}}async execBlock(e,t){for(let a of e){let i=await this.execStmt(a,t);if(i instanceof y)return i}}async execImport(e,t){if(this.imported.has(e.path))return;if(this.imported.add(e.path),e.path.startsWith("package:")){let o=e.path.slice(8),c=R(o),m;try{m=this.pkgResolver(o)}catch(l){throw new r(`Tsy hita ny package "${o}": ${l.message}`)}t.define(c,{kind:"native",value:m});return}let a;try{a=this.resolver(e.path)}catch(o){throw new r(`Tsy azo ampidirina ny "${e.path}": ${o.message}`)}let i=new k(a).tokenize(),n=new v(i).parse(),s=new h(null);for(let o of n.body)await this.execStmt(o,s);for(let o of n.body)if((o.type==="FunctionDeclaration"||o.type==="VariableDeclaration")&&o.exported){let c=o.name;t.define(c,s.get(c))}}async execVarDecl(e,t){if(e.value===null){typeof e.varType=="object"&&e.varType.kind==="Lisitra"?t.define(e.name,{kind:"list",elements:[],elementType:e.varType.inner}):t.define(e.name,null);return}let a=await this.execExpr(e.value,t);this.checkType(a,e.varType,e.name,this.nodePos(e)),this.isList(a)&&typeof e.varType=="object"&&e.varType.kind==="Lisitra"&&(a.elementType=e.varType.inner),t.define(e.name,a)}execFuncDecl(e,t){t.define(e.name,{kind:"function",name:e.name,params:e.params,body:e.body,closure:t})}async execIf(e,t){if(this.isTruthy(await this.execExpr(e.condition,t)))return this.execBlock(e.consequent,new h(t));if(e.alternate)return this.execBlock(e.alternate,new h(t))}async execWhile(e,t){for(;this.isTruthy(await this.execExpr(e.condition,t));){let a=await this.execBlock(e.body,new h(t));if(a instanceof y)return a}}async execReturn(e,t){let a=e.value?await this.execExpr(e.value,t):null;return new y(a)}async execPrint(e,t){this.printFn(this.stringify(await this.execExpr(e.value,t)))}async execExpr(e,t){switch(e.type){case"NumericLiteral":return e.value;case"StringLiteral":return e.value;case"BooleanLiteral":return e.value;case"TsisyLiteral":return null;case"Identifier":return t.get(e.name);case"AssignmentExpression":return this.execAssign(e,t);case"BinaryExpression":return this.execBinary(e,t);case"UnaryExpression":{let a=await this.execExpr(e.operand,t);return this.noTsisy(a,"tsy"),!this.isTruthy(a)}case"AwaitExpression":return this.execAwait(e,t);case"CallExpression":return this.execCall(e,t);case"MemberCallExpression":return this.execMemberCall(e,t);case"MemberExpression":return this.execMemberAccess(e,t);case"ListLiteral":return this.execListLiteral(e,t);case"IndexExpression":return this.execIndexExpr(e,t)}}async execAssign(e,t){let a=await this.execExpr(e.value,t);return t.assign(e.name,a),a}async execBinary(e,t){if(e.operator==="ary"){let n=await this.execExpr(e.left,t);if(this.noTsisy(n,"ary"),!this.isTruthy(n))return!1;let s=await this.execExpr(e.right,t);return this.noTsisy(s,"ary"),this.isTruthy(s)}if(e.operator==="na"){let n=await this.execExpr(e.left,t);if(this.noTsisy(n,"na"),this.isTruthy(n))return!0;let s=await this.execExpr(e.right,t);return this.noTsisy(s,"na"),this.isTruthy(s)}let a=await this.execExpr(e.left,t),i=await this.execExpr(e.right,t);switch(e.operator!=="=="&&e.operator!=="!="&&(this.noTsisy(a,e.operator),this.noTsisy(i,e.operator)),e.operator){case"+":if(typeof a=="number"&&typeof i=="number")return a+i;if(typeof a=="string"||typeof i=="string")return String(a)+String(i);throw new r(`Tsy azo ampiasaina ny "+" eo amin'ny ${this.typeOf(a)} sy ${this.typeOf(i)}`);case"-":return this.numOp(a,i,"-",(n,s)=>n-s);case"*":return this.numOp(a,i,"*",(n,s)=>n*s);case"/":if(i===0)throw new r("Tsy azo zaraina amin'ny aotra (0)");return this.numOp(a,i,"/",(n,s)=>n/s);case"==":return a===i;case"!=":return a!==i;case"<":return this.numOp(a,i,"<",(n,s)=>n<s);case"<=":return this.numOp(a,i,"<=",(n,s)=>n<=s);case">":return this.numOp(a,i,">",(n,s)=>n>s);case">=":return this.numOp(a,i,">=",(n,s)=>n>=s);default:throw new r(`Mpanao tsy fantatra: "${e.operator}"`)}}async execCall(e,t){let a=t.get(e.callee);if(a!==null&&typeof a=="object"&&a.kind==="native"){let o=a.value;if(typeof o=="function"){let c=await Promise.all(e.args.map(l=>this.execExpr(l,t))),m=o(...c);return this.tobaiko(m)}}if(!a||typeof a!="object"||a.kind!=="function")throw new r(`"${e.callee}" tsy asa \u2014 ${this.typeOf(a)} no noraisina`);let i=a;if(e.args.length!==i.params.length)throw new r(`"${i.name}" mitaky tohan-teny ${i.params.length} fa ${e.args.length} no nomena`);let n=new h(i.closure);for(let o=0;o<i.params.length;o++){let c=await this.execExpr(e.args[o],t);this.checkType(c,i.params[o].paramType,i.params[o].name),n.define(i.params[o].name,c)}let s=await this.execBlock(i.body,n);return s instanceof y?s.value:null}async execMemberCall(e,t){let a=await this.execExpr(e.object,t);if(this.isList(a)){let c=a,m=e.object.type==="Identifier"?e.object.name:"lisitra";switch(e.method){case"ampidiro":{if(e.args.length!==1)throw new r('"ampidiro" mitaky tohan-teny iray');let l=await this.execExpr(e.args[0],t);return this.checkElementType(l,c.elementType,m,this.nodePos(e)),c.elements.push(l),null}case"ovay":{if(e.args.length!==1)throw new r('"ovay" mitaky tohan-teny iray (asa)');let l=await this.execExpr(e.args[0],t),u=[];for(let f of c.elements)u.push(await this.applyCallable(l,[f]));return{kind:"list",elements:u,elementType:c.elementType}}case"tsingano":{if(e.args.length!==1)throw new r('"tsingano" mitaky tohan-teny iray (asa)');let l=await this.execExpr(e.args[0],t),u=[];for(let f of c.elements)this.isTruthy(await this.applyCallable(l,[f]))&&u.push(f);return{kind:"list",elements:u,elementType:c.elementType}}case"atambaro":{if(e.args.length!==2)throw new r('"atambaro" mitaky tohan-teny roa (soatoavina voalohany, asa)');let l=await this.execExpr(e.args[0],t),u=await this.execExpr(e.args[1],t);for(let f of c.elements)l=await this.applyCallable(u,[l,f]);return l}default:throw new r(`"${e.method}" tsy fantatry ny lisitra`)}}if(a===null||typeof a!="object"||a.kind!=="native")throw new r(`tsy sehatra natif \u2014 ${this.typeOf(a)} no noraisina`);let i=a.value,n=i[e.method];if(typeof n!="function")throw new r(`".${e.method}" tsy asa natif`);let s=await Promise.all(e.args.map(c=>this.execExpr(c,t))),o=n.call(i,...s);return this.tobaiko(o)}async execMemberAccess(e,t){let a=await this.execExpr(e.object,t);if(this.isList(a)){if(e.property==="isany")return a.elements.length;throw new r(`"${e.property}" tsy fantatry ny lisitra`)}if(a===null||typeof a!="object"||a.kind!=="native")throw new r(`tsy sehatra natif \u2014 ${this.typeOf(a)} no noraisina`);let i=a.value;return this.tobaiko(i[e.property])}async execListLiteral(e,t){return{kind:"list",elements:await Promise.all(e.elements.map(i=>this.execExpr(i,t))),elementType:"Isa"}}async execIndexExpr(e,t){let a=await this.execExpr(e.object,t),i=await this.execExpr(e.index,t);if(!this.isList(a))throw new r(`Tsy lisitra \u2014 ${this.typeOf(a)} no noraisina`);if(typeof i!="number")throw new r(`Index tokony ho isa fa ${this.typeOf(i)} no noraisina`);let n=a.elements[i];if(n===void 0)throw new r(`Index ivelan'ny faritra: ${i}`);return n}async execIndexAssignment(e,t){let a=t.get(e.object),i=await this.execExpr(e.index,t),n=await this.execExpr(e.value,t);if(!this.isList(a))throw new r(`"${e.object}" tsy lisitra`);if(typeof i!="number")throw new r(`Index tokony ho isa fa ${this.typeOf(i)} no noraisina`);this.checkElementType(n,a.elementType,e.object,this.nodePos(e)),a.elements[i]=n}async applyCallable(e,t){if(!e||typeof e!="object"||e.kind!=="function")throw new r(`Mitaky asa fa ${this.typeOf(e)} no noraisina`);let a=e;if(t.length!==a.params.length)throw new r(`"${a.name}" mitaky tohan-teny ${a.params.length} fa ${t.length} no nomena`);let i=new h(a.closure);for(let s=0;s<a.params.length;s++)this.checkType(t[s],a.params[s].paramType,a.params[s].name),i.define(a.params[s].name,t[s]);let n=await this.execBlock(a.body,i);return n instanceof y?n.value:null}checkElementType(e,t,a,i){let n=i?` ${i}`:"";if(typeof t=="string"){let s={Isa:"number",Soratra:"string",Marina:"boolean"};if(this.typeOf(e)!==s[t])throw new r(`Tsy mety ny karazana amin'ny lisitra "${a}": niriny ${t} fa ${this.typeOf(e)} no noraisina${n}`)}else{if(!this.isList(e))throw new r(`Tsy mety ny karazana amin'ny lisitra "${a}": niriny lisitra fa ${this.typeOf(e)} no noraisina${n}`);let s=t.inner;for(let o=0;o<e.elements.length;o++)this.checkElementType(e.elements[o],s,`${a}[${o}]`,i)}}nodePos(e){return e.line!=null?`(andalana ${e.line}, toerana ${e.col})`:void 0}async execAwait(e,t){let a=await this.execExpr(e.value,t);if(a!==null&&typeof a=="object"&&a.kind==="native"){let i=a.value;if(i!==null&&typeof i=="object"&&typeof i.then=="function"){let n=await i;return this.tobaiko(n)}}return a}tobaiko(e){return e==null?null:typeof e=="number"||typeof e=="string"||typeof e=="boolean"?e:{kind:"native",value:e}}noTsisy(e,t){if(e===null)throw new r(`Tsy azo ampiasaina ny "tsisy" amin'ny "${t}"`)}numOp(e,t,a,i){if(this.isNative(e)||this.isNative(t))return{kind:"native",value:null};if(typeof e!="number"||typeof t!="number")throw new r(`"${a}" mitaky isa fa noraisina ${this.typeOf(e)} sy ${this.typeOf(t)}`);return i(e,t)}isNative(e){return e!==null&&typeof e=="object"&&e.kind==="native"}checkType(e,t,a,i){if(!(typeof e=="object"&&e!==null&&e.kind==="native"))if(typeof t=="object"){let n=t;if(n.kind==="Mety"){if(e===null)return;let s=n.inner;if(typeof s=="string")this.checkBaseType(e,s,a);else if(!this.isList(e))throw new r(`Tsy mety ny karazana ho an'ny "${a}": niriny lisitra fa ${this.typeOf(e)} no noraisina`)}else{if(!this.isList(e))throw new r(`Tsy mety ny karazana ho an'ny "${a}": niriny lisitra fa ${this.typeOf(e)} no noraisina`);let s=n.inner;for(let o of e.elements)this.checkElementType(o,s,a,i)}}else{if(e===null)throw new r(`Tsy mety ny karazana ho an'ny "${a}": niriny ${t} fa tsisy no noraisina`);this.checkBaseType(e,t,a)}}checkBaseType(e,t,a){let i={Isa:"number",Soratra:"string",Marina:"boolean"};if(this.typeOf(e)!==i[t])throw new r(`Tsy mety ny karazana ho an'ny "${a}": niriny ${t} fa ${this.typeOf(e)} no noraisina`)}typeOf(e){return e===null?"null":this.isList(e)?"lisitra":typeof e=="object"&&e.kind==="native"?"natif":typeof e=="object"?"function":typeof e}isList(e){return e!==null&&typeof e=="object"&&e.kind==="list"}isTruthy(e){return e===null||e===!1?!1:typeof e=="number"?e!==0:typeof e=="string"?e.length>0:!0}stringify(e){if(e===null)return"tsisy";if(e===!0)return"marina";if(e===!1)return"diso";if(this.isList(e))return"["+e.elements.map(t=>this.stringify(t)).join(", ")+"]";if(typeof e=="object"&&e.kind==="native"){let t=e.value;try{return JSON.stringify(t)}catch{return String(t)}}return typeof e=="object"?`<asa ${e.name}>`:String(e)}};function d(){let p=(...e)=>d();return new Proxy(p,{get:(e,t)=>t==="then"?void 0:(...a)=>d()})}var M=p=>d();async function V(p,e){try{let t=new k(p).tokenize(),a=new v(t).parse();return await new g(void 0,e,M).run(a),[]}catch(t){let a=t instanceof Error?t.message:String(t),i=a.match(/\(andalana (\d+), toerana (\d+)\)/);return[{message:a,line:i?parseInt(i[1]):null,col:i?parseInt(i[2]):null}]}}0&&(module.exports={checkBaiko});
