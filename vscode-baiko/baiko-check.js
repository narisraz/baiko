"use strict";var f=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var d=(s,e)=>{for(var t in e)f(s,t,{get:e[t],enumerable:!0})},S=(s,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of g(e))!E.call(s,r)&&r!==t&&f(s,r,{get:()=>e[r],enumerable:!(a=v(e,r))||a.enumerable});return s};var T=s=>S(f({},"__esModule",{value:!0}),s);var A={};d(A,{checkBaiko:()=>B});module.exports=T(A);var b={asa:"Asa",raha:"Raha",ankoatra:"Ankoatra",mamoaka:"Mamoaka",dia:"Dia",farany:"Farany",asehoy:"Asehoy",avereno:"Avereno",marina:"True",diso:"False",tsisy:"Tsisy",Mety:"Mety",ampidiro:"Ampidiro",ary:"And",na:"Or",tsy:"Not",Isa:"Isa",Soratra:"Soratra",Marina:"Marina"},c=class{constructor(e){this.pos=0;this.line=1;this.column=1;this.source=e}tokenize(){let e=[];for(;this.pos<this.source.length&&(this.skipWhitespaceAndComments(),!(this.pos>=this.source.length));)e.push(this.nextToken());return e.push({type:"EOF",value:"",line:this.line,column:this.column}),e}nextToken(){let e=this.source[this.pos],t=this.line,a=this.column;if(this.isDigit(e))return this.readNumber(t,a);if(e==='"')return this.readString(t,a);if(this.isAlpha(e))return this.readWord(t,a);let r=this.source.slice(this.pos,this.pos+2),n={"==":"EqualEqual","!=":"BangEqual","<=":"LessEqual",">=":"GreaterEqual"};if(n[r])return this.pos+=2,this.column+=2,{type:n[r],value:r,line:t,column:a};let i={"+":"Plus","-":"Minus","*":"Star","/":"Slash","=":"Equal","<":"Less",">":"Greater","(":"LeftParen",")":"RightParen",":":"Colon",",":"Comma",";":"Semicolon"};if(i[e])return this.advance(),{type:i[e],value:e,line:t,column:a};throw new Error(`Litera tsy fantatra '${e}' (andalana ${t}, toerana ${a})`)}readNumber(e,t){let a="";for(;this.pos<this.source.length&&this.isDigit(this.source[this.pos]);)a+=this.advance();if(this.source[this.pos]===".")for(a+=this.advance();this.pos<this.source.length&&this.isDigit(this.source[this.pos]);)a+=this.advance();return{type:"Number",value:a,line:e,column:t}}readString(e,t){this.advance();let a="";for(;this.pos<this.source.length&&this.source[this.pos]!=='"';)if(this.source[this.pos]==="\\"){this.advance();let r=this.advance();a+=r==="n"?`
`:r==="t"?"	":r}else a+=this.advance();if(this.pos>=this.source.length)throw new Error(`Soratra tsy voafaritra: tsy misy '"' mamarana ny soratra natomboka (andalana ${e}, toerana ${t})`);return this.advance(),{type:"String",value:a,line:e,column:t}}readWord(e,t){let a="";for(;this.pos<this.source.length&&this.isAlphaNumeric(this.source[this.pos]);)a+=this.advance();return{type:b[a]??"Identifier",value:a,line:e,column:t}}skipWhitespaceAndComments(){for(;this.pos<this.source.length;){let e=this.source[this.pos];if(/\s/.test(e)){e===`
`?(this.line++,this.column=1):this.column++,this.pos++;continue}if(e==="#"){for(;this.pos<this.source.length&&this.source[this.pos]!==`
`;)this.pos++;continue}break}}advance(){let e=this.source[this.pos++];return this.column++,e}isDigit(e){return e>="0"&&e<="9"}isAlpha(e){return/[a-zA-Z_]/.test(e)}isAlphaNumeric(e){return/[a-zA-Z0-9_]/.test(e)}};var x=new Set(["Isa","Soratra","Marina"]),w={Semicolon:'";" (famaranana ny tsipika)',Dia:'"dia" (fanombohana ny bloka)',Farany:'"farany" (famaranana ny bloka)',Ankoatra:'"ankoatra" (sampana hafa)',Equal:'"=" (fandrafesana)',EqualEqual:'"==" (fitoviana)',Colon:'":" (mari-karazana)',Comma:'"," (misaraka ny tohan-teny)',LeftParen:'"(" (fanombohana ny tohan-teny)',RightParen:'")" (famaranana ny tohan-teny)',Identifier:"anarana (identifier)",Isa:'"Isa" (karazana isa)',Soratra:'"Soratra" (karazana soratra)',Marina:'"Marina" (karazana boolean)',Mety:'"Mety" (karazana azo tsisy)',Raha:'"raha"'};function m(s,e){return`(andalana ${s}, toerana ${e})`}var l=class{constructor(e){this.pos=0;this.tokens=e}parse(){let e=[];for(;!this.isEOF();)e.push(this.parseStatement());return{type:"Program",body:e}}parseStatement(){if(this.check("Avereno")&&this.tokens[this.pos+1]?.type==="Raha")return this.parseWhileStatement();if(this.check("Identifier")&&this.tokens[this.pos+1]?.type==="Colon"&&(x.has(this.tokens[this.pos+2]?.type)||this.tokens[this.pos+2]?.type==="Mety"))return this.parseVariableDeclaration();switch(this.peek().type){case"Asa":return this.parseFunctionDeclaration();case"Raha":return this.parseIfStatement();case"Mamoaka":return this.parseReturnStatement();case"Asehoy":return this.parsePrintStatement();case"Ampidiro":return this.parseImportStatement();default:return this.parseExpressionStatement()}}parseFunctionDeclaration(){this.expect("Asa");let e=this.expect("Identifier").value;this.expect("LeftParen");let t=this.parseParams();this.expect("RightParen");let a=null;this.match("Colon")&&(a=this.parseType()),this.expect("Dia");let r=this.parseBlock();return this.expect("Farany"),{type:"FunctionDeclaration",name:e,params:t,returnType:a,body:r}}parseVariableDeclaration(){let e=this.expect("Identifier").value;this.expect("Colon");let t=this.parseVarType(),a=typeof t=="object",r=null;if(this.match("Equal"))r=this.parseExpression();else if(!a){let n=this.peek();throw new Error(`"${e}" karazana tsy azo tsisy: tokony hanana soatoavina fiorenana ${m(n.line,n.column)}`)}return this.expect("Semicolon"),{type:"VariableDeclaration",varType:t,name:e,value:r}}parseVarType(){if(this.check("Mety")){this.advance(),this.expect("LeftParen");let e=this.parseType();return this.expect("RightParen"),{kind:"Mety",inner:e}}return this.parseType()}parseParams(){let e=[];if(this.check("RightParen"))return e;do{let t=this.expect("Identifier").value;this.expect("Colon");let a=this.parseType();e.push({type:"Parameter",name:t,paramType:a})}while(this.match("Comma"));return e}parseType(){let e=this.peek();if(!x.has(e.type))throw new Error(`Tokony ho karazana (Isa, Soratra, Marina) fa "${e.value}" no noraisina ${m(e.line,e.column)}`);return this.advance(),e.value}parseIfStatement(){this.expect("Raha");let e=this.parseExpression();this.expect("Dia");let t=this.parseBlock(),a=null;return this.match("Ankoatra")&&(this.expect("Dia"),a=this.parseBlock()),this.expect("Farany"),{type:"IfStatement",condition:e,consequent:t,alternate:a}}parseWhileStatement(){this.expect("Avereno"),this.expect("Raha");let e=this.parseExpression();this.expect("Dia");let t=this.parseBlock();return this.expect("Farany"),{type:"WhileStatement",condition:e,body:t}}parseReturnStatement(){this.expect("Mamoaka");let e=null;return this.check("Semicolon")||(e=this.parseExpression()),this.expect("Semicolon"),{type:"ReturnStatement",value:e}}parsePrintStatement(){this.expect("Asehoy");let e=this.parseExpression();return this.expect("Semicolon"),{type:"PrintStatement",value:e}}parseImportStatement(){this.expect("Ampidiro");let e=this.expect("String");return this.expect("Semicolon"),{type:"ImportStatement",path:e.value}}parseExpressionStatement(){let e=this.parseExpression();return this.expect("Semicolon"),{type:"ExpressionStatement",expression:e}}parseBlock(){let e=[],t=new Set(["Farany","Ankoatra","EOF"]);for(;!t.has(this.peek().type);)e.push(this.parseStatement());return e}parseExpression(){return this.parseAssignment()}parseAssignment(){if(this.check("Identifier")&&this.tokens[this.pos+1]?.type==="Equal"){let e=this.advance().value;this.advance();let t=this.parseExpression();return{type:"AssignmentExpression",name:e,value:t}}return this.parseLogicalOr()}parseLogicalOr(){let e=this.parseLogicalAnd();for(;this.check("Or");){let t=this.advance().value,a=this.parseLogicalAnd();e={type:"BinaryExpression",operator:t,left:e,right:a}}return e}parseLogicalAnd(){let e=this.parseComparison();for(;this.check("And");){let t=this.advance().value,a=this.parseComparison();e={type:"BinaryExpression",operator:t,left:e,right:a}}return e}parseComparison(){let e=this.parseAdditive(),t=new Set(["EqualEqual","BangEqual","Less","LessEqual","Greater","GreaterEqual"]);for(;t.has(this.peek().type);){let a=this.advance().value,r=this.parseAdditive();e={type:"BinaryExpression",operator:a,left:e,right:r}}return e}parseAdditive(){let e=this.parseMultiplicative();for(;this.check("Plus")||this.check("Minus");){let t=this.advance().value,a=this.parseMultiplicative();e={type:"BinaryExpression",operator:t,left:e,right:a}}return e}parseMultiplicative(){let e=this.parseUnary();for(;this.check("Star")||this.check("Slash");){let t=this.advance().value,a=this.parseUnary();e={type:"BinaryExpression",operator:t,left:e,right:a}}return e}parseUnary(){if(this.check("Not"))return this.advance(),{type:"UnaryExpression",operator:"tsy",operand:this.parseUnary()};if(this.check("Minus")){let e=this.advance().value,t=this.parsePrimary();return{type:"BinaryExpression",operator:e,left:{type:"NumericLiteral",value:0},right:t}}return this.parsePrimary()}parsePrimary(){let e=this.peek();if(e.type==="Number")return this.advance(),{type:"NumericLiteral",value:parseFloat(e.value)};if(e.type==="String")return this.advance(),{type:"StringLiteral",value:e.value};if(e.type==="Identifier"){if(this.advance(),this.match("LeftParen")){let t=this.parseArgs();return this.expect("RightParen"),{type:"CallExpression",callee:e.value,args:t}}return{type:"Identifier",name:e.value}}if(e.type==="True"||e.type==="False")return this.advance(),{type:"BooleanLiteral",value:e.type==="True"};if(e.type==="Tsisy")return this.advance(),{type:"TsisyLiteral"};if(e.type==="LeftParen"){this.advance();let t=this.parseExpression();return this.expect("RightParen"),t}throw new Error(`Teny tsy andraina: "${e.value}" ${m(e.line,e.column)}`)}parseArgs(){let e=[];if(this.check("RightParen"))return e;do e.push(this.parseExpression());while(this.match("Comma"));return e}match(...e){for(let t of e)if(this.check(t))return this.advance(),!0;return!1}expect(e){if(!this.check(e)){let t=this.peek(),a=w[e]??`"${e}"`,r=t.value?`"${t.value}"`:"fiafaran'ny rakitra";throw new Error(`Nandiny ${r} fa nilaina ${a} ${m(t.line,t.column)}`)}return this.advance()}check(e){return this.peek().type===e}advance(){return this.isEOF()||this.pos++,this.tokens[this.pos-1]}peek(){return this.tokens[this.pos]}isEOF(){return this.peek().type==="EOF"}};var u=class{constructor(e){this.value=e}},p=class{constructor(e=null){this.parent=e;this.store=new Map}get(e){if(this.store.has(e))return this.store.get(e);if(this.parent)return this.parent.get(e);throw new o(`Tsy fantatra ny "${e}" \u2014 ilaina ny fanambarana azy aloha`)}define(e,t){this.store.set(e,t)}assign(e,t){if(this.store.has(e)){this.store.set(e,t);return}if(this.parent){this.parent.assign(e,t);return}throw new o(`Tsy azo ovaina ny "${e}" \u2014 tsy mbola nofaritana`)}},o=class extends Error{constructor(e){super(e),this.name="RuntimeError"}},y=class{constructor(e,t){this.global=new p;this.imported=new Set;this.printFn=e??(a=>console.log(a)),this.resolver=t??(()=>{throw new o("Tsy azo ampidirina ny rakitra ato amin'ity toerana ity")})}run(e){for(let t of e.body)this.execStmt(t,this.global)}execStmt(e,t){switch(e.type){case"VariableDeclaration":return this.execVarDecl(e,t);case"FunctionDeclaration":return this.execFuncDecl(e,t);case"ImportStatement":return this.execImport(e,t);case"IfStatement":return this.execIf(e,t);case"WhileStatement":return this.execWhile(e,t);case"ReturnStatement":return this.execReturn(e,t);case"PrintStatement":return this.execPrint(e,t);case"ExpressionStatement":this.execExpr(e.expression,t);return}}execBlock(e,t){for(let a of e){let r=this.execStmt(a,t);if(r instanceof u)return r}}execImport(e,t){if(this.imported.has(e.path))return;this.imported.add(e.path);let a;try{a=this.resolver(e.path)}catch(i){throw new o(`Tsy azo ampidirina ny "${e.path}": ${i.message}`)}let r=new c(a).tokenize(),n=new l(r).parse();for(let i of n.body)this.execStmt(i,t)}execVarDecl(e,t){if(e.value===null){t.define(e.name,null);return}let a=this.execExpr(e.value,t);this.checkType(a,e.varType,e.name),t.define(e.name,a)}execFuncDecl(e,t){t.define(e.name,{kind:"function",name:e.name,params:e.params,body:e.body,closure:t})}execIf(e,t){if(this.isTruthy(this.execExpr(e.condition,t)))return this.execBlock(e.consequent,new p(t));if(e.alternate)return this.execBlock(e.alternate,new p(t))}execWhile(e,t){for(;this.isTruthy(this.execExpr(e.condition,t));){let a=this.execBlock(e.body,new p(t));if(a instanceof u)return a}}execReturn(e,t){let a=e.value?this.execExpr(e.value,t):null;return new u(a)}execPrint(e,t){this.printFn(this.stringify(this.execExpr(e.value,t)))}execExpr(e,t){switch(e.type){case"NumericLiteral":return e.value;case"StringLiteral":return e.value;case"BooleanLiteral":return e.value;case"TsisyLiteral":return null;case"Identifier":return t.get(e.name);case"AssignmentExpression":return this.execAssign(e,t);case"BinaryExpression":return this.execBinary(e,t);case"UnaryExpression":{let a=this.execExpr(e.operand,t);return this.noTsisy(a,"tsy"),!this.isTruthy(a)}case"CallExpression":return this.execCall(e,t)}}execAssign(e,t){let a=this.execExpr(e.value,t);return t.assign(e.name,a),a}execBinary(e,t){if(e.operator==="ary"){let n=this.execExpr(e.left,t);if(this.noTsisy(n,"ary"),!this.isTruthy(n))return!1;let i=this.execExpr(e.right,t);return this.noTsisy(i,"ary"),this.isTruthy(i)}if(e.operator==="na"){let n=this.execExpr(e.left,t);if(this.noTsisy(n,"na"),this.isTruthy(n))return!0;let i=this.execExpr(e.right,t);return this.noTsisy(i,"na"),this.isTruthy(i)}let a=this.execExpr(e.left,t),r=this.execExpr(e.right,t);switch(e.operator!=="=="&&e.operator!=="!="&&(this.noTsisy(a,e.operator),this.noTsisy(r,e.operator)),e.operator){case"+":if(typeof a=="number"&&typeof r=="number")return a+r;if(typeof a=="string"||typeof r=="string")return String(a)+String(r);throw new o(`Tsy azo ampiasaina ny "+" eo amin'ny ${this.typeOf(a)} sy ${this.typeOf(r)}`);case"-":return this.numOp(a,r,"-",(n,i)=>n-i);case"*":return this.numOp(a,r,"*",(n,i)=>n*i);case"/":if(r===0)throw new o("Tsy azo zaraina amin'ny aotra (0)");return this.numOp(a,r,"/",(n,i)=>n/i);case"==":return a===r;case"!=":return a!==r;case"<":return this.numOp(a,r,"<",(n,i)=>n<i);case"<=":return this.numOp(a,r,"<=",(n,i)=>n<=i);case">":return this.numOp(a,r,">",(n,i)=>n>i);case">=":return this.numOp(a,r,">=",(n,i)=>n>=i);default:throw new o(`Mpanao tsy fantatra: "${e.operator}"`)}}execCall(e,t){let a=t.get(e.callee);if(!a||typeof a!="object"||a.kind!=="function")throw new o(`"${e.callee}" tsy asa \u2014 ${this.typeOf(a)} no noraisina`);let r=a;if(e.args.length!==r.params.length)throw new o(`"${r.name}" mitaky tohan-teny ${r.params.length} fa ${e.args.length} no nomena`);let n=new p(r.closure);for(let h=0;h<r.params.length;h++){let k=this.execExpr(e.args[h],t);this.checkType(k,r.params[h].paramType,r.params[h].name),n.define(r.params[h].name,k)}let i=this.execBlock(r.body,n);return i instanceof u?i.value:null}noTsisy(e,t){if(e===null)throw new o(`Tsy azo ampiasaina ny "tsisy" amin'ny "${t}"`)}numOp(e,t,a,r){if(typeof e!="number"||typeof t!="number")throw new o(`"${a}" mitaky isa fa noraisina ${this.typeOf(e)} sy ${this.typeOf(t)}`);return r(e,t)}checkType(e,t,a){if(typeof t=="object"&&t.kind==="Mety"){if(e===null)return;this.checkBaseType(e,t.inner,a)}else{if(e===null)throw new o(`Tsy mety ny karazana ho an'ny "${a}": niriny ${t} fa tsisy no noraisina`);this.checkBaseType(e,t,a)}}checkBaseType(e,t,a){let r={Isa:"number",Soratra:"string",Marina:"boolean"};if(this.typeOf(e)!==r[t])throw new o(`Tsy mety ny karazana ho an'ny "${a}": niriny ${t} fa ${this.typeOf(e)} no noraisina`)}typeOf(e){return e===null?"null":typeof e=="object"?"function":typeof e}isTruthy(e){return e===null||e===!1?!1:typeof e=="number"?e!==0:typeof e=="string"?e.length>0:!0}stringify(e){return e===null?"tsisy":e===!0?"marina":e===!1?"diso":typeof e=="object"?`<asa ${e.name}>`:String(e)}};function B(s,e){try{let t=new c(s).tokenize(),a=new l(t).parse();return new y(void 0,e).run(a),[]}catch(t){let a=t instanceof Error?t.message:String(t),r=a.match(/\(andalana (\d+), toerana (\d+)\)/);return[{message:a,line:r?parseInt(r[1]):null,col:r?parseInt(r[2]):null}]}}0&&(module.exports={checkBaiko});
